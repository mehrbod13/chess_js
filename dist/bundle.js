(()=>{"use strict";class e{constructor(e,t,s,i,l){this.type=e,this.side=t,this.board=s,this.col=i,this.row=l,this.elem=this.getElement(),this.isMoved=!1}getAssest(){return`./assets/${this.type}-${this.side}.svg`}getElement(){let e=document.createElement("div");e.classList.add("piece");let t=document.createElement("img");return t.setAttribute("src",this.getAssest()),e.appendChild(t),e}getMoves(){return[]}getValidMoves(){return this.getMoves().filter((t=>{var s;return(null===(s=t.square)||void 0===s?void 0:s.type)!==e.TYPE.KING&&this.checkMove(t)}))}move(e,t){var s,i;for(let l of this.getValidMoves())if(e===l.col&&t===l.row)return l.isCastle&&(6===l.row?null===(s=l.square)||void 0===s||s.move(l.col,5):2===l.row&&(null===(i=l.square)||void 0===i||i.move(l.col,3))),this.board.board[this.col][this.row]=null,this.board.board[e][t]=this,this.col=e,this.row=t,!0;return!1}checkMove(t){let s=this.side===e.SIDES.WHITE?this.board.whiteKing:this.board.blackKing;this.board.board[this.col][this.row]=null;let i=this.board.board[t.col][t.row];this.board.board[t.col][t.row]=this;let l=0===s.isChecked().length;return this.board.board[this.col][this.row]=this,this.board.board[t.col][t.row]=i,l}}e.SIDES={BLACK:"Black",WHITE:"White"},e.TYPE={PAWN:"Pawn",ROOK:"Rook",KNIGHT:"Knight",BISHOP:"Bishop",QUEEN:"Queen",KING:"King"};class t{constructor(e,t,s,i,l=!1){this.piece=e,this.col=t,this.row=s,this.square=i,this.isCastle=l}}class s extends e{constructor(t,s,i,l){super(e.TYPE.ROOK,t,s,i,l)}getMoves(){let e=[];for(let s=1;s<8;++s){let i=this.row+s;if(i>7)break;let l=this.board.getSquare(this.col,i);if(null!==l){l.side!==this.side&&e.push(new t(this,this.col,i,l));break}e.push(new t(this,this.col,i,l))}for(let s=1;s<8;++s){let i=this.row-s;if(i<0)break;let l=this.board.getSquare(this.col,i);if(null!==l){l.side!==this.side&&e.push(new t(this,this.col,i,l));break}e.push(new t(this,this.col,i,l))}for(let s=1;s<8;++s){let i=this.col+s;if(i>7)break;let l=this.board.getSquare(i,this.row);if(null!==l){l.side!==this.side&&e.push(new t(this,i,this.row,l));break}e.push(new t(this,i,this.row,l))}for(let s=1;s<8;++s){let i=this.col-s;if(i<0)break;let l=this.board.getSquare(i,this.row);if(null!==l){l.side!==this.side&&e.push(new t(this,i,this.row,l));break}e.push(new t(this,i,this.row,l))}return e}}class i extends e{constructor(t,s,i,l){super(e.TYPE.KING,t,s,i,l)}getMoves(){let e=[];for(let s=-1;s<=1;++s)for(let i=-1;i<=1;++i){if(0===s&&0===i)continue;let l=this.col+s,h=this.row+i;if(l>=0&&l<=7&&h>=0&&h<=7){let s=this.board.getSquare(l,h);if(null!==s&&s.side===this.side)continue;e.push(new t(this,l,h,s))}}if(!this.isMoved){let i=!0;for(let e=1;e<=2;++e)if(null!==this.board.getSquare(this.col,this.row+e)){i=!1;break}let l=this.board.getSquare(this.col,this.row+3);i&&l&&l instanceof s&&!l.isMoved&&e.push(new t(this,this.col,this.row+2,l,!0))}if(!this.isMoved){let i=!0;for(let e=1;e<=3;++e)if(null!==this.board.getSquare(this.col,this.row-e)){i=!1;break}let l=this.board.getSquare(this.col,this.row-4);i&&l&&l instanceof s&&!l.isMoved&&e.push(new t(this,this.col,this.row-2,l,!0))}return e}isChecked(){let e=[];for(let t=0;t<8;++t)for(let s=0;s<8;++s){let i=this.board.getSquare(t,s);if(i&&i.side!==this.side)for(let t of i.getMoves())t.square===this&&e.push(i)}return e}}class l extends e{constructor(t,s,i,l){super(e.TYPE.KNIGHT,t,s,i,l)}getMoves(){let e=[];for(let s of[-2,2])for(let i of[-1,1]){let l=this.col+s,h=this.row+i;if(l>=0&&l<=7&&h>=0&&h<=7){let s=this.board.getSquare(l,h);(null==s?void 0:s.side)!==this.side&&e.push(new t(this,l,h,s))}}for(let s of[-1,1])for(let i of[-2,2]){let l=this.col+s,h=this.row+i;if(l>=0&&l<=7&&h>=0&&h<=7){let s=this.board.getSquare(l,h);(null==s?void 0:s.side)!==this.side&&e.push(new t(this,l,h,s))}}return e}}class h extends e{constructor(t,s,i,l){super(e.TYPE.BISHOP,t,s,i,l)}getMoves(){let e=[];for(let s=1;s<8;++s){let i=this.col+s,l=this.row+s;if(i>7||l>7)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}for(let s=1;s<8;++s){let i=this.col-s,l=this.row-s;if(i<0||l<0)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}for(let s=1;s<8;++s){let i=this.col-s,l=this.row+s;if(i<0||l>7)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}for(let s=1;s<8;++s){let i=this.col+s,l=this.row-s;if(i>7||l<0)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}return e}}class r extends e{constructor(t,s,i,l){super(e.TYPE.QUEEN,t,s,i,l)}getMoves(){let e=[];for(let s=1;s<8;++s){let i=this.row+s;if(i>7)break;let l=this.board.getSquare(this.col,i);if(null!==l){l.side!==this.side&&e.push(new t(this,this.col,i,l));break}e.push(new t(this,this.col,i,l))}for(let s=1;s<8;++s){let i=this.row-s;if(i<0)break;let l=this.board.getSquare(this.col,i);if(null!==l){l.side!==this.side&&e.push(new t(this,this.col,i,l));break}e.push(new t(this,this.col,i,l))}for(let s=1;s<8;++s){let i=this.col+s;if(i>7)break;let l=this.board.getSquare(i,this.row);if(null!==l){l.side!==this.side&&e.push(new t(this,i,this.row,l));break}e.push(new t(this,i,this.row,l))}for(let s=1;s<8;++s){let i=this.col-s;if(i<0)break;let l=this.board.getSquare(i,this.row);if(null!==l){l.side!==this.side&&e.push(new t(this,i,this.row,l));break}e.push(new t(this,i,this.row,l))}for(let s=1;s<8;++s){let i=this.col+s,l=this.row+s;if(i>7||l>7)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}for(let s=1;s<8;++s){let i=this.col-s,l=this.row-s;if(i<0||l<0)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}for(let s=1;s<8;++s){let i=this.col-s,l=this.row+s;if(i<0||l>7)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}for(let s=1;s<8;++s){let i=this.col+s,l=this.row-s;if(i>7||l<0)break;let h=this.board.getSquare(i,l);if(null!==h){h.side!==this.side&&e.push(new t(this,i,l,h));break}e.push(new t(this,i,l,h))}return e}}class o extends e{constructor(t,s,i,l){super(e.TYPE.PAWN,t,s,i,l),this.isMoved=!1}getMoves(){let s=[];for(let i=1;i<=(this.isMoved?1:2);++i){let l=this.side===e.SIDES.BLACK?i:-i,h=this.col+l;if(h>=0&&h<=7){let e=this.board.getSquare(h,this.row);if(null!==e)break;s.push(new t(this,h,this.row,e))}}let i=this.side===e.SIDES.BLACK?1:-1;for(let e of[-1,1]){let l=this.col+i,h=this.row+e;if(h>=0&&h<=7&&l>=0&&l<=7){let e=this.board.getSquare(l,h);null!==e&&e.side!==this.side&&s.push(new t(this,l,h,e))}}return s}}class n{constructor(t){this.blackKing=new i(e.SIDES.BLACK,this,0,4),this.whiteKing=new i(e.SIDES.WHITE,this,7,4),this.board=this.initBoard(),this.selectedPiece=null,this.game=t}initBoard(){return[[new s(e.SIDES.BLACK,this,0,0),new l(e.SIDES.BLACK,this,0,1),new h(e.SIDES.BLACK,this,0,2),new r(e.SIDES.BLACK,this,0,3),this.blackKing,new h(e.SIDES.BLACK,this,0,5),new l(e.SIDES.BLACK,this,0,6),new s(e.SIDES.BLACK,this,0,7)],[new o(e.SIDES.BLACK,this,1,0),new o(e.SIDES.BLACK,this,1,1),new o(e.SIDES.BLACK,this,1,2),new o(e.SIDES.BLACK,this,1,3),new o(e.SIDES.BLACK,this,1,4),new o(e.SIDES.BLACK,this,1,5),new o(e.SIDES.BLACK,this,1,6),new o(e.SIDES.BLACK,this,1,7)],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new o(e.SIDES.WHITE,this,6,0),new o(e.SIDES.WHITE,this,6,1),new o(e.SIDES.WHITE,this,6,2),new o(e.SIDES.WHITE,this,6,3),new o(e.SIDES.WHITE,this,6,4),new o(e.SIDES.WHITE,this,6,5),new o(e.SIDES.WHITE,this,6,6),new o(e.SIDES.WHITE,this,6,7)],[new s(e.SIDES.WHITE,this,7,0),new l(e.SIDES.WHITE,this,7,1),new h(e.SIDES.WHITE,this,7,2),new r(e.SIDES.WHITE,this,7,3),this.whiteKing,new h(e.SIDES.WHITE,this,7,5),new l(e.SIDES.WHITE,this,7,6),new s(e.SIDES.WHITE,this,7,7)]]}registerHandlers(){for(let e=0;e<8;++e)for(let t=0;t<8;++t){let s=this.getSquare(e,t);null!==s&&s.elem.addEventListener("click",(()=>{this.selectPiece(s)}))}}getSquare(e,t){return this.board[e][t]}getElement(){let e=document.createElement("div");e.classList.add("board");let t=!0;for(let s=0;s<8;++s)for(let l=0;l<8;++l){let h=this.getSquare(s,l);0!==l&&(t=!t);let r=document.createElement("div");if(r.classList.add("square"),r.style.backgroundColor=t?"var(--white-square)":"var(--black-square)",0==l){let e=document.createElement("div");e.classList.add("number-icon"),e.innerHTML=""+(8-s),e.style.color=t?"var(--black-square)":"var(--white-square)",r.appendChild(e)}if(7==s){let e=document.createElement("div");e.classList.add("char-icon"),e.innerHTML=`${String.fromCharCode(97+l)}`,e.style.color=t?"var(--black-square)":"var(--white-square)",r.appendChild(e)}null!==h&&(h instanceof i&&h.isChecked()&&h.elem.classList.add("checked"),r.appendChild(h.elem)),e.appendChild(r)}return e}selectPiece(e){if(this.game.turn===e.side){document.querySelectorAll(".highlighted").forEach((e=>{e.classList.remove("highlighted")})),this.selectedPiece=e;for(let t of e.getValidMoves()){this.highlightSquare(t.col,t.row);let e=document.querySelector(`.square:nth-child(${8*t.col+t.row+1})`);e&&(null==e||e.addEventListener("click",(()=>this.moveListener(t.col,t.row))))}}}moveListener(e,t){null!==this.selectedPiece&&this.selectedPiece.move(e,t)&&(this.selectedPiece.isMoved||(this.selectedPiece.isMoved=!0),this.game.drawBoard(),this.game.reverseTurn())}highlightSquare(e,t){let s=document.querySelector(`.square:nth-child(${8*e+t+1})`);null==s||s.classList.add("highlighted")}}new class{constructor(t){this.elem=t,this.pieces=[],this.board=new n(this),this.board.registerHandlers(),this.turn=e.SIDES.WHITE}reverseTurn(){this.turn===e.SIDES.WHITE?this.turn=e.SIDES.BLACK:this.turn=e.SIDES.WHITE}drawBoard(){this.elem.innerHTML="",this.elem.appendChild(this.board.getElement())}}(document.body).drawBoard()})();