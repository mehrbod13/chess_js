(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{z:()=>u});class e{constructor(t){this.pawn=t,this.options=[i.TYPE.QUEEN,i.TYPE.BISHOP,i.TYPE.KNIGHT,i.TYPE.ROOK]}getElement(){let t=document.createElement("div");t.classList.add("promo"),t.style.top=this.pawn.side===i.SIDES.WHITE?"-130%":"130%";for(let e of this.options){let s=document.createElement("div");s.classList.add("option"),s.addEventListener("click",(()=>{this.pawn.promoteTo(e)}));let o=document.createElement("img");o.setAttribute("src",i.getAsset(e,this.pawn.side)),s.appendChild(o),t.appendChild(s)}return t}}class i{static getPoint(t){switch(t){case i.TYPE.PAWN:return 1;case i.TYPE.BISHOP:case i.TYPE.KNIGHT:return 3;case i.TYPE.ROOK:return 5;case i.TYPE.QUEEN:return 9;default:return 0}}static getAsset(t,e){return`./assets/${t}-${e}.svg`}constructor(t,e,i,s,o){this.type=t,this.side=e,this.board=i,this.row=s,this.col=o,this.elem=this.getElement(),this.registerHandler(),this.isMoved=!1,this.isCaptured=!1,this.board.game.pieces[this.side].push(this)}getPosition(){return[this.row,this.col]}getElement(){let t=document.createElement("div");t.classList.add("piece");let e=document.createElement("img");return e.setAttribute("src",i.getAsset(this.type,this.side)),t.appendChild(e),t}getMoves(){return[]}getValidMoves(){return this.getMoves().filter((t=>{var e;return(null===(e=t.square)||void 0===e?void 0:e.type)!==i.TYPE.KING&&this.checkMove(t)}))}move(t,s){var o,h;for(let l of this.getValidMoves())if(s===l.to.col&&t===l.to.row){if(l.isCastle&&(6===l.to.col?null===(o=l.square)||void 0===o||o.move(l.to.row,5):2===l.to.col&&(null===(h=l.square)||void 0===h||h.move(l.to.row,3))),this.board.board[this.row][this.col]=null,this.board.board[t][s]=this,this.col=s,this.row=t,this.type===i.TYPE.PAWN&&l.isPromotion){let t=new e(this);this.elem.appendChild(t.getElement()),this.board.isolated=!0}return!0}return!1}checkMove(t){let e=this.side===i.SIDES.WHITE?this.board.whiteKing:this.board.blackKing;this.board.board[this.row][this.col]=null;let s=this.board.board[t.to.row][t.to.col];this.board.board[t.to.row][t.to.col]=this;let o=0===e.isChecked().length;return this.board.board[this.row][this.col]=this,this.board.board[t.to.row][t.to.col]=s,o}registerHandler(){this.elem.addEventListener("click",(()=>{this.board.selectPiece(this)}))}}i.SIDES={BLACK:"Black",WHITE:"White"},i.TYPE={PAWN:"Pawn",ROOK:"Rook",KNIGHT:"Knight",BISHOP:"Bishop",QUEEN:"Queen",KING:"King"};class s extends i{constructor(t,e,s,o){super(i.TYPE.KNIGHT,t,e,s,o)}getMoves(){let t=[];for(let e of[-2,2])for(let i of[-1,1]){let s=this.row+e,o=this.col+i;if(s>=0&&s<=7&&o>=0&&o<=7){let e=this.board.getPieceAt(s,o);(null==e?void 0:e.side)!==this.side&&t.push(new n(this,this.getPosition(),[s,o],e))}}for(let e of[-1,1])for(let i of[-2,2]){let s=this.row+e,o=this.col+i;if(s>=0&&s<=7&&o>=0&&o<=7){let e=this.board.getPieceAt(s,o);(null==e?void 0:e.side)!==this.side&&t.push(new n(this,this.getPosition(),[s,o],e))}}return t}}class o extends i{constructor(t,e,s,o){super(i.TYPE.QUEEN,t,e,s,o)}getMoves(){let t=[];for(let e=1;e<8;++e){let i=this.col+e;if(i>7)break;let s=this.board.getPieceAt(this.row,i);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[this.row,i],s));break}t.push(new n(this,this.getPosition(),[this.row,i],s))}for(let e=1;e<8;++e){let i=this.col-e;if(i<0)break;let s=this.board.getPieceAt(this.row,i);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[this.row,i],s));break}t.push(new n(this,this.getPosition(),[this.row,i],s))}for(let e=1;e<8;++e){let i=this.row+e;if(i>7)break;let s=this.board.getPieceAt(i,this.col);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[i,this.col],s));break}t.push(new n(this,this.getPosition(),[i,this.col],s))}for(let e=1;e<8;++e){let i=this.row-e;if(i<0)break;let s=this.board.getPieceAt(i,this.col);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[i,this.col],s));break}t.push(new n(this,this.getPosition(),[i,this.col],s))}for(let e=1;e<8;++e){let i=this.row+e,s=this.col+e;if(i>7||s>7)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}for(let e=1;e<8;++e){let i=this.row-e,s=this.col-e;if(i<0||s<0)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}for(let e=1;e<8;++e){let i=this.row-e,s=this.col+e;if(i<0||s>7)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}for(let e=1;e<8;++e){let i=this.row+e,s=this.col-e;if(i>7||s<0)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}return t}}class h extends i{constructor(t,e,s,o){super(i.TYPE.ROOK,t,e,s,o)}getMoves(){let t=[];for(let e=1;e<8;++e){let i=this.col+e;if(i>7)break;let s=this.board.getPieceAt(this.row,i);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[this.row,i],s));break}t.push(new n(this,this.getPosition(),[this.row,i],s))}for(let e=1;e<8;++e){let i=this.col-e;if(i<0)break;let s=this.board.getPieceAt(this.row,i);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[this.row,i],s));break}t.push(new n(this,this.getPosition(),[this.row,i],s))}for(let e=1;e<8;++e){let i=this.row+e;if(i>7)break;let s=this.board.getPieceAt(i,this.col);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[i,this.col],s));break}t.push(new n(this,this.getPosition(),[i,this.col],s))}for(let e=1;e<8;++e){let i=this.row-e;if(i<0)break;let s=this.board.getPieceAt(i,this.col);if(null!==s){s.side!==this.side&&t.push(new n(this,this.getPosition(),[i,this.col],s));break}t.push(new n(this,this.getPosition(),[i,this.col],s))}return t}}class l extends i{constructor(t,e,s,o){super(i.TYPE.BISHOP,t,e,s,o)}getMoves(){let t=[];for(let e=1;e<8;++e){let i=this.row+e,s=this.col+e;if(i>7||s>7)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}for(let e=1;e<8;++e){let i=this.row-e,s=this.col-e;if(i<0||s<0)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}for(let e=1;e<8;++e){let i=this.row-e,s=this.col+e;if(i<0||s>7)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}for(let e=1;e<8;++e){let i=this.row+e,s=this.col-e;if(i>7||s<0)break;let o=this.board.getPieceAt(i,s);if(null!==o){o.side!==this.side&&t.push(new n(this,this.getPosition(),[i,s],o));break}t.push(new n(this,this.getPosition(),[i,s],o))}return t}}class r extends i{constructor(t,e,s,o){super(i.TYPE.PAWN,t,e,s,o),this.isMoved=!1}getMoves(){let t=[];for(let e=1;e<=(this.isMoved?1:2);++e){let s=this.side===i.SIDES.BLACK?e:-e,o=this.row+s;if(o>=0&&o<=7){let e=this.board.getPieceAt(o,this.col);if(null!==e)break;{let i=new n(this,this.getPosition(),[o,this.col],e);i.isPromotion=this.isPromoted(o),t.push(i)}}}let e=this.side===i.SIDES.BLACK?1:-1;for(let i of[-1,1]){let s=this.row+e,o=this.col+i;if(o>=0&&o<=7&&s>=0&&s<=7){let e=this.board.getPieceAt(s,o);if(null!==e&&e.side!==this.side){let i=new n(this,this.getPosition(),[s,o],e);i.isPromotion=this.isPromoted(s),t.push(i)}}}return t}isPromoted(t=this.row){return this.side===i.SIDES.BLACK&&7===t||this.side===i.SIDES.WHITE&&0==t}promoteTo(t){let e;switch(t){case i.TYPE.QUEEN:e=new o(this.side,this.board,this.row,this.col);break;case i.TYPE.KNIGHT:e=new s(this.side,this.board,this.row,this.col);break;case i.TYPE.ROOK:e=new h(this.side,this.board,this.row,this.col);break;case i.TYPE.BISHOP:e=new l(this.side,this.board,this.row,this.col);break;default:return void console.error("promotion piece type is invalid!")}this.isCaptured=!0,e.isMoved=!0,this.board.board[this.row][this.col]=e,this.board.isolated=!1,this.board.game.drawBoard(),this.board.game.reverseTurn()}}class n{constructor(t,e,i,s,o=!1,h=!1,l=!1){this.piece=t,this.from={row:e[0],col:e[1]},this.to={row:i[0],col:i[1]},this.square=s,this.isCastle=o,this.isCheck=h,this.isPromotion=l}isCapture(){return null!==this.square}getNotation(){if(this.isCastle)return 6===this.to.col?"O-O":"O-O-O";let t="",e=this.piece.type[0];return this.piece instanceof s?e="N":this.piece instanceof r&&(e=""),t+=e,this.isCapture()&&(this.piece instanceof r&&(t+=String.fromCharCode(97+this.from.col)),t+="x"),t+=String.fromCharCode(97+this.to.col),t+=8-this.to.row,this.isCheck&&(t+="+"),t}}class a extends i{constructor(t,e,s,o){super(i.TYPE.KING,t,e,s,o)}getMoves(){let t=[];for(let e=-1;e<=1;++e)for(let i=-1;i<=1;++i){if(0===e&&0===i)continue;let s=this.row+e,o=this.col+i;if(s>=0&&s<=7&&o>=0&&o<=7){let e=this.board.getPieceAt(s,o);if(null!==e&&e.side===this.side)continue;t.push(new n(this,this.getPosition(),[s,o],e))}}if(!this.isChecked().length){if(!this.isMoved){let e=!0;for(let t=1;t<=2;++t)if(null!==this.board.getPieceAt(this.row,this.col+t)){e=!1;break}let i=this.board.getPieceAt(this.row,this.col+3);e&&i&&i instanceof h&&!i.isMoved&&t.push(new n(this,this.getPosition(),[this.row,this.col+2],i,!0))}if(!this.isMoved){let e=!0;for(let t=1;t<=3;++t)if(null!==this.board.getPieceAt(this.row,this.col-t)){e=!1;break}let i=this.board.getPieceAt(this.row,this.col-4);e&&i&&i instanceof h&&!i.isMoved&&t.push(new n(this,this.getPosition(),[this.row,this.col-2],i,!0))}}return t}isChecked(){let t=[];for(let e=0;e<8;++e)for(let i=0;i<8;++i){let s=this.board.getPieceAt(e,i);if(s&&s.side!==this.side&&!(s instanceof a))for(let e of s.getMoves())e.square===this&&t.push(s)}return t}isCheckmated(){if(this.getValidMoves().length>0)return!1;for(let t of this.board.game.pieces[this.side])if(t.getValidMoves().length>0)return!1;return!0}}class d{constructor(t){this.game=t,this.blackKing=new a(i.SIDES.BLACK,this,0,4),this.whiteKing=new a(i.SIDES.WHITE,this,7,4),this.board=this.initBoard(),this.selectedPiece=null,this.history=[],this.isolated=!1}initBoard(){return[[new h(i.SIDES.BLACK,this,0,0),new s(i.SIDES.BLACK,this,0,1),new l(i.SIDES.BLACK,this,0,2),new o(i.SIDES.BLACK,this,0,3),this.blackKing,new l(i.SIDES.BLACK,this,0,5),new s(i.SIDES.BLACK,this,0,6),new h(i.SIDES.BLACK,this,0,7)],[new r(i.SIDES.BLACK,this,1,0),new r(i.SIDES.BLACK,this,1,1),new r(i.SIDES.BLACK,this,1,2),new r(i.SIDES.BLACK,this,1,3),new r(i.SIDES.BLACK,this,1,4),new r(i.SIDES.BLACK,this,1,5),new r(i.SIDES.BLACK,this,1,6),new r(i.SIDES.BLACK,this,1,7)],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new r(i.SIDES.WHITE,this,6,0),new r(i.SIDES.WHITE,this,6,1),new r(i.SIDES.WHITE,this,6,2),new r(i.SIDES.WHITE,this,6,3),new r(i.SIDES.WHITE,this,6,4),new r(i.SIDES.WHITE,this,6,5),new r(i.SIDES.WHITE,this,6,6),new r(i.SIDES.WHITE,this,6,7)],[new h(i.SIDES.WHITE,this,7,0),new s(i.SIDES.WHITE,this,7,1),new l(i.SIDES.WHITE,this,7,2),new o(i.SIDES.WHITE,this,7,3),this.whiteKing,new l(i.SIDES.WHITE,this,7,5),new s(i.SIDES.WHITE,this,7,6),new h(i.SIDES.WHITE,this,7,7)]]}getPieceAt(t,e){return this.board[t][e]}getSquare(t,e){return document.querySelector(`.square:nth-child(${8*t+e+1})`)}getElement(){let t=document.createElement("div");t.classList.add("column-flex");let e=0,s=document.createElement("div");s.setAttribute("id","white_cp");for(let t of this.game.captures[i.SIDES.WHITE]){let o=document.createElement("img");o.src=i.getAsset(t,i.SIDES.WHITE),s.appendChild(o),e+=i.getPoint(t)}t.appendChild(s);let o=document.createElement("div");o.classList.add("board");let h=!0;for(let t=0;t<8;++t)for(let e=0;e<8;++e){let i=this.getPieceAt(t,e);0!==e&&(h=!h);let s=document.createElement("div");if(s.classList.add("square"),s.classList.add(h?"white":"black"),0==e){let e=document.createElement("div");e.classList.add("number-icon"),e.innerHTML=""+(8-t),e.style.color=h?"var(--black-square)":"var(--white-square)",s.appendChild(e)}if(7==t){let t=document.createElement("div");t.classList.add("char-icon"),t.innerHTML=`${String.fromCharCode(97+e)}`,t.style.color=h?"var(--black-square)":"var(--white-square)",s.appendChild(t)}null!==i&&(i instanceof a&&(i.isChecked().length?(i.elem.classList.add("checked"),i.isCheckmated()&&(document.getElementById("checkmate__menu").style.display="flex",document.querySelector("#checkmate__menu>.message>.side").innerHTML=this.game.turn,document.querySelector("#restart_button").addEventListener("click",(()=>{u()})))):i.elem.classList.remove("checked")),s.appendChild(i.elem)),o.appendChild(s)}t.appendChild(o);let l=document.createElement("div");l.setAttribute("id","black_cp");let r=0;for(let t of this.game.captures[i.SIDES.BLACK]){let e=document.createElement("img");e.src=i.getAsset(t,i.SIDES.BLACK),l.appendChild(e),r+=i.getPoint(t)}return t.appendChild(l),e>r?s.innerHTML+="+"+(e-r):r>e&&(l.innerHTML+="+"+(r-e)),t}selectPiece(t){if(this.game.turn===t.side&&!this.isolated){document.querySelectorAll(".highlighted").forEach((t=>{t.classList.remove("highlighted")})),this.selectedPiece=t;for(let e of t.getValidMoves()){this.highlightSquare(e.to.row,e.to.col);let t=this.getSquare(e.to.row,e.to.col);t&&(null==t||t.addEventListener("click",(()=>this.moveListener(e))))}}}moveListener(t){if(t.piece===this.selectedPiece&&this.selectedPiece.move(t.to.row,t.to.col)){for(let e of t.piece.getMoves())if(e.square instanceof a){t.isCheck=!0;break}if(t.isCapture()){let e=t.square;e.isCaptured=!0,this.game.captures[e.side].push(e.type)}this.history.push(t),this.selectedPiece.isMoved||(this.selectedPiece.isMoved=!0),this.selectedPiece=null,this.game.drawBoard(),t.isPromotion||this.game.reverseTurn()}}highlightSquare(t,e){let i=this.getSquare(t,e);null==i||i.classList.add("highlighted")}}class c{constructor(t){this.elem=t,this.captures={[i.SIDES.WHITE]:[],[i.SIDES.BLACK]:[]},this.pieces={[i.SIDES.WHITE]:[],[i.SIDES.BLACK]:[]},this.board=new d(this),this.turn=i.SIDES.WHITE}reverseTurn(){this.turn===i.SIDES.WHITE?this.turn=i.SIDES.BLACK:this.turn=i.SIDES.WHITE}drawBoard(){console.log(this.pieces),this.elem.innerHTML="",this.elem.appendChild(this.board.getElement());let t=document.createElement("div");if(t.classList.add("history"),this.board.history.length>0){let t=this.board.history[this.board.history.length-1];this.board.getSquare(t.from.row,t.from.col).classList.add("last-move"),this.board.getSquare(t.to.row,t.to.col).classList.add("last-move")}for(let e=0;e<this.board.history.length;++e){let i=this.board.history[e],s=document.createElement("div");s.innerHTML=`${e+1}.${i.getNotation()}`,t.appendChild(s)}this.elem.appendChild(t)}}function u(){document.getElementById("checkmate__menu").style.display="none";let t=document.getElementById("game");new c(t).drawBoard()}u()})();