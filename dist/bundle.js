(()=>{"use strict";class e{constructor(e,t,s,i,l){this.type=e,this.side=t,this.board=s,this.col=i,this.row=l,this.elem=this.getElement(),this.isMoved=!1}getAssest(){return`./assets/${this.type}-${this.side}.svg`}getElement(){let e=document.createElement("div");e.classList.add("piece");let t=document.createElement("img");return t.setAttribute("src",this.getAssest()),e.appendChild(t),e}getMoves(){return[]}getValidMoves(){return this.getMoves().filter((t=>{var s;return(null===(s=t.square)||void 0===s?void 0:s.type)!==e.TYPE.KING&&this.checkMove(t)}))}move(e,t){var s,i;for(let l of this.getValidMoves())if(e===l.col&&t===l.row)return l.isCastle&&(6===l.row?null===(s=l.square)||void 0===s||s.move(l.col,5):2===l.row&&(null===(i=l.square)||void 0===i||i.move(l.col,3))),this.board.board[this.col][this.row]=null,this.board.board[e][t]=this,this.col=e,this.row=t,!0;return!1}checkMove(t){let s=this.side===e.SIDES.WHITE?this.board.whiteKing:this.board.blackKing;this.board.board[this.col][this.row]=null;let i=this.board.board[t.col][t.row];this.board.board[t.col][t.row]=this;let l=0===s.isChecked().length;return this.board.board[this.col][this.row]=this,this.board.board[t.col][t.row]=i,l}}e.SIDES={BLACK:"Black",WHITE:"White"},e.TYPE={PAWN:"Pawn",ROOK:"Rook",KNIGHT:"Knight",BISHOP:"Bishop",QUEEN:"Queen",KING:"King"};class t extends e{constructor(t,s,i,l){super(e.TYPE.KNIGHT,t,s,i,l)}getMoves(){let e=[];for(let t of[-2,2])for(let s of[-1,1]){let l=this.col+t,h=this.row+s;if(l>=0&&l<=7&&h>=0&&h<=7){let t=this.board.getSquare(l,h);(null==t?void 0:t.side)!==this.side&&e.push(new i(this,l,h,t))}}for(let t of[-1,1])for(let s of[-2,2]){let l=this.col+t,h=this.row+s;if(l>=0&&l<=7&&h>=0&&h<=7){let t=this.board.getSquare(l,h);(null==t?void 0:t.side)!==this.side&&e.push(new i(this,l,h,t))}}return e}}class s extends e{constructor(t,s,i,l){super(e.TYPE.PAWN,t,s,i,l),this.isMoved=!1}getMoves(){let t=[];for(let s=1;s<=(this.isMoved?1:2);++s){let l=this.side===e.SIDES.BLACK?s:-s,h=this.col+l;if(h>=0&&h<=7){let e=this.board.getSquare(h,this.row);if(null!==e)break;t.push(new i(this,h,this.row,e))}}let s=this.side===e.SIDES.BLACK?1:-1;for(let e of[-1,1]){let l=this.col+s,h=this.row+e;if(h>=0&&h<=7&&l>=0&&l<=7){let e=this.board.getSquare(l,h);null!==e&&e.side!==this.side&&t.push(new i(this,l,h,e))}}return t}}class i{constructor(e,t,s,i,l=!1,h=!1){this.piece=e,this.col=t,this.row=s,this.square=i,this.isCastle=l,this.isCheck=h}getNotation(){if(this.isCastle)return 6===this.row?"O-O":"O-O-O";let e="",i=this.piece.type[0];return this.piece instanceof t?i="N":this.piece instanceof s&&(i=""),e+=i,null!==this.square&&(this.piece instanceof s&&(e+=String.fromCharCode(97+this.piece.row)),e+="x"),e+=String.fromCharCode(97+this.row),e+=8-this.col,this.isCheck&&(e+="+"),e}}class l extends e{constructor(t,s,i,l){super(e.TYPE.ROOK,t,s,i,l)}getMoves(){let e=[];for(let t=1;t<8;++t){let s=this.row+t;if(s>7)break;let l=this.board.getSquare(this.col,s);if(null!==l){l.side!==this.side&&e.push(new i(this,this.col,s,l));break}e.push(new i(this,this.col,s,l))}for(let t=1;t<8;++t){let s=this.row-t;if(s<0)break;let l=this.board.getSquare(this.col,s);if(null!==l){l.side!==this.side&&e.push(new i(this,this.col,s,l));break}e.push(new i(this,this.col,s,l))}for(let t=1;t<8;++t){let s=this.col+t;if(s>7)break;let l=this.board.getSquare(s,this.row);if(null!==l){l.side!==this.side&&e.push(new i(this,s,this.row,l));break}e.push(new i(this,s,this.row,l))}for(let t=1;t<8;++t){let s=this.col-t;if(s<0)break;let l=this.board.getSquare(s,this.row);if(null!==l){l.side!==this.side&&e.push(new i(this,s,this.row,l));break}e.push(new i(this,s,this.row,l))}return e}}class h extends e{constructor(t,s,i,l){super(e.TYPE.KING,t,s,i,l)}getMoves(){let e=[];for(let t=-1;t<=1;++t)for(let s=-1;s<=1;++s){if(0===t&&0===s)continue;let l=this.col+t,h=this.row+s;if(l>=0&&l<=7&&h>=0&&h<=7){let t=this.board.getSquare(l,h);if(null!==t&&t.side===this.side)continue;e.push(new i(this,l,h,t))}}if(!this.isMoved){let t=!0;for(let e=1;e<=2;++e)if(null!==this.board.getSquare(this.col,this.row+e)){t=!1;break}let s=this.board.getSquare(this.col,this.row+3);t&&s&&s instanceof l&&!s.isMoved&&e.push(new i(this,this.col,this.row+2,s,!0))}if(!this.isMoved){let t=!0;for(let e=1;e<=3;++e)if(null!==this.board.getSquare(this.col,this.row-e)){t=!1;break}let s=this.board.getSquare(this.col,this.row-4);t&&s&&s instanceof l&&!s.isMoved&&e.push(new i(this,this.col,this.row-2,s,!0))}return e}isChecked(){let e=[];for(let t=0;t<8;++t)for(let s=0;s<8;++s){let i=this.board.getSquare(t,s);if(i&&i.side!==this.side)for(let t of i.getMoves())t.square===this&&e.push(i)}return e}}class r extends e{constructor(t,s,i,l){super(e.TYPE.BISHOP,t,s,i,l)}getMoves(){let e=[];for(let t=1;t<8;++t){let s=this.col+t,l=this.row+t;if(s>7||l>7)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}for(let t=1;t<8;++t){let s=this.col-t,l=this.row-t;if(s<0||l<0)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}for(let t=1;t<8;++t){let s=this.col-t,l=this.row+t;if(s<0||l>7)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}for(let t=1;t<8;++t){let s=this.col+t,l=this.row-t;if(s>7||l<0)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}return e}}class o extends e{constructor(t,s,i,l){super(e.TYPE.QUEEN,t,s,i,l)}getMoves(){let e=[];for(let t=1;t<8;++t){let s=this.row+t;if(s>7)break;let l=this.board.getSquare(this.col,s);if(null!==l){l.side!==this.side&&e.push(new i(this,this.col,s,l));break}e.push(new i(this,this.col,s,l))}for(let t=1;t<8;++t){let s=this.row-t;if(s<0)break;let l=this.board.getSquare(this.col,s);if(null!==l){l.side!==this.side&&e.push(new i(this,this.col,s,l));break}e.push(new i(this,this.col,s,l))}for(let t=1;t<8;++t){let s=this.col+t;if(s>7)break;let l=this.board.getSquare(s,this.row);if(null!==l){l.side!==this.side&&e.push(new i(this,s,this.row,l));break}e.push(new i(this,s,this.row,l))}for(let t=1;t<8;++t){let s=this.col-t;if(s<0)break;let l=this.board.getSquare(s,this.row);if(null!==l){l.side!==this.side&&e.push(new i(this,s,this.row,l));break}e.push(new i(this,s,this.row,l))}for(let t=1;t<8;++t){let s=this.col+t,l=this.row+t;if(s>7||l>7)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}for(let t=1;t<8;++t){let s=this.col-t,l=this.row-t;if(s<0||l<0)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}for(let t=1;t<8;++t){let s=this.col-t,l=this.row+t;if(s<0||l>7)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}for(let t=1;t<8;++t){let s=this.col+t,l=this.row-t;if(s>7||l<0)break;let h=this.board.getSquare(s,l);if(null!==h){h.side!==this.side&&e.push(new i(this,s,l,h));break}e.push(new i(this,s,l,h))}return e}}class n{constructor(t){this.blackKing=new h(e.SIDES.BLACK,this,0,4),this.whiteKing=new h(e.SIDES.WHITE,this,7,4),this.board=this.initBoard(),this.selectedPiece=null,this.game=t,this.history=[]}initBoard(){return[[new l(e.SIDES.BLACK,this,0,0),new t(e.SIDES.BLACK,this,0,1),new r(e.SIDES.BLACK,this,0,2),new o(e.SIDES.BLACK,this,0,3),this.blackKing,new r(e.SIDES.BLACK,this,0,5),new t(e.SIDES.BLACK,this,0,6),new l(e.SIDES.BLACK,this,0,7)],[new s(e.SIDES.BLACK,this,1,0),new s(e.SIDES.BLACK,this,1,1),new s(e.SIDES.BLACK,this,1,2),new s(e.SIDES.BLACK,this,1,3),new s(e.SIDES.BLACK,this,1,4),new s(e.SIDES.BLACK,this,1,5),new s(e.SIDES.BLACK,this,1,6),new s(e.SIDES.BLACK,this,1,7)],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[new s(e.SIDES.WHITE,this,6,0),new s(e.SIDES.WHITE,this,6,1),new s(e.SIDES.WHITE,this,6,2),new s(e.SIDES.WHITE,this,6,3),new s(e.SIDES.WHITE,this,6,4),new s(e.SIDES.WHITE,this,6,5),new s(e.SIDES.WHITE,this,6,6),new s(e.SIDES.WHITE,this,6,7)],[new l(e.SIDES.WHITE,this,7,0),new t(e.SIDES.WHITE,this,7,1),new r(e.SIDES.WHITE,this,7,2),new o(e.SIDES.WHITE,this,7,3),this.whiteKing,new r(e.SIDES.WHITE,this,7,5),new t(e.SIDES.WHITE,this,7,6),new l(e.SIDES.WHITE,this,7,7)]]}registerHandlers(){for(let e=0;e<8;++e)for(let t=0;t<8;++t){let s=this.getSquare(e,t);null!==s&&s.elem.addEventListener("click",(()=>{this.selectPiece(s)}))}}getSquare(e,t){return this.board[e][t]}getElement(){let e=document.createElement("div");e.classList.add("board");let t=!0;for(let s=0;s<8;++s)for(let i=0;i<8;++i){let l=this.getSquare(s,i);0!==i&&(t=!t);let r=document.createElement("div");if(r.classList.add("square"),r.style.backgroundColor=t?"var(--white-square)":"var(--black-square)",0==i){let e=document.createElement("div");e.classList.add("number-icon"),e.innerHTML=""+(8-s),e.style.color=t?"var(--black-square)":"var(--white-square)",r.appendChild(e)}if(7==s){let e=document.createElement("div");e.classList.add("char-icon"),e.innerHTML=`${String.fromCharCode(97+i)}`,e.style.color=t?"var(--black-square)":"var(--white-square)",r.appendChild(e)}null!==l&&(l instanceof h&&(l.isChecked().length?l.elem.classList.add("checked"):l.elem.classList.remove("checked")),r.appendChild(l.elem)),e.appendChild(r)}return e}selectPiece(e){if(this.game.turn===e.side){document.querySelectorAll(".highlighted").forEach((e=>{e.classList.remove("highlighted")})),this.selectedPiece=e;for(let t of e.getValidMoves()){this.highlightSquare(t.col,t.row);let e=document.querySelector(`.square:nth-child(${8*t.col+t.row+1})`);e&&(null==e||e.addEventListener("click",(()=>this.moveListener(t))))}}}moveListener(e){if(null!==this.selectedPiece&&(this.selectedPiece.row,this.selectedPiece.move(e.col,e.row))){for(let t of e.piece.getMoves())if(t.square instanceof h){e.isCheck=!0;break}this.history.push(e),this.selectedPiece.isMoved||(this.selectedPiece.isMoved=!0),this.selectedPiece=null,this.game.drawBoard(),this.game.reverseTurn()}}highlightSquare(e,t){let s=document.querySelector(`.square:nth-child(${8*e+t+1})`);null==s||s.classList.add("highlighted")}}let a=document.getElementById("game"),u=new class{constructor(t){this.elem=t,this.pieces=[],this.board=new n(this),this.board.registerHandlers(),this.turn=e.SIDES.WHITE}reverseTurn(){this.turn===e.SIDES.WHITE?this.turn=e.SIDES.BLACK:this.turn=e.SIDES.WHITE}drawBoard(){this.elem.innerHTML="",this.elem.appendChild(this.board.getElement());let e=document.createElement("div");e.classList.add("history");for(let t=0;t<this.board.history.length;++t){let s=this.board.history[t],i=document.createElement("div");i.innerHTML=`${t+1}.${s.getNotation()}`,e.appendChild(i)}this.elem.appendChild(e)}}(a);u.drawBoard()})();